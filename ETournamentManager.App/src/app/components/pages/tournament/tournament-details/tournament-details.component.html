<div id="tournament-container">
  @if (tournamentData !== null) {
    <div id="banner-header">
      <app-e-image-upload
        [entityId]="tournamentId"
        [imgUrl]="tournamentImageUrl"
        [hideActions]="
          tournamentData.creator.id !== currentUserProfile?.id &&
          currentUserProfile?.roleName !== 'ADMIN'
        "
      />
      <div class="banner-info-wrapper">
        <h1 class="title">{{ tournamentData.name }}</h1>
        <h4 class="description">{{ tournamentData.description }}</h4>
        <p class="contact">
          For tournament details - Contact:
          <a class="contact-mail" [href]="'mailto:' + tournamentData.creator.email">
            {{ tournamentData.creator.email }}
          </a>
        </p>
      </div>
      <div class="edit-wrapper" (click)="onEditClick()">
        <img class="edit-icon" src="assets/images/edit-icon.svg" alt="Edit icon" />
      </div>
    </div>

    @if (
      roundsData.length === 0 &&
      currentUserProfile !== null &&
      (tournamentData.creator.id === currentUserProfile.id ||
        currentUserProfile.roleName === 'ADMIN')
    ) {
      <div id="tournament-actions">
        <app-e-input
          label="Add team"
          [isSearch]="true"
          [searchResult]="searchTeamNames"
          (inputChanged)="getTeamByName($event)"
          (searchResultSelected)="selectTeam($event)"
        />

        <button id="start-tournament" (click)="onStartClick()">Start Tournament</button>

        <div class="error-message" [ngStyle]="{ 'align-self': 'center' }">
          {{ startTournamentError }}
        </div>
      </div>
    }

    <div class="section-container">
      <div class="title-wrapper">
        <div class="title">Participent Teams</div>
        <hr />
      </div>

      <div class="info-cards-container">
        @for (currentTeam of tournamentTeamsData; track $index) {
          <app-e-info-card
            [cardData]="getTeamInfoCard(currentTeam)"
            (cardClicked)="onCardSelect(currentTeam.id, '/team')"
          >
            @if (
              !tournamentData.active &&
              (tournamentData.creator.id === currentUserProfile?.id ||
                currentUserProfile?.roleName === 'ADMIN')
            ) {
              <div
                actions
                class="actions"
                (click)="$event.stopPropagation(); onRemoveTeamClick(currentTeam.id)"
              >
                <img src="assets/images/close-icon.svg" alt="Close icon" />
              </div>
            }

            <div statsIcons class="stats-info">
              <img src="assets/images/first-place-medal.svg" alt="First Place Medal" />
              <div class="subtitle">
                {{ currentTeam.tournamentsWon }}
              </div>

              <img src="assets/images/people-icon.svg" alt="People Icon" />
              <div class="subtitle">
                {{ currentTeam.members.length }}
              </div>
            </div>
          </app-e-info-card>
        }
      </div>
    </div>

    @if (roundsData.length > 0) {
      <div class="bracket-wrapper">
        <app-tournament-bracket
          [roundsData]="roundsData"
          [tournamentId]="tournamentId"
          [canChooseWinner]="
            currentUserProfile !== null &&
            (tournamentData.creator.id === currentUserProfile.id ||
              currentUserProfile.roleName === 'ADMIN')
          "
        />
      </div>
    }
  }
</div>
