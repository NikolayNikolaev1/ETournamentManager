<div id="tournament-container">
  @if (tournamentData !== null) {
    <div id="banner-header">
      <app-e-image-upload
        [entityId]="tournamentId"
        [imgUrl]="tournamentImageUrl"
        [hideActions]="tournamentData.creator.id !== currentUserProfile?.id && currentUserProfile?.roleName !== 'ADMIN'"
      />
      <div class="banner-info-wrapper">
        <h1 class="title">{{ tournamentData.name }}</h1>
        <h4 class="description">{{ tournamentData.description }}</h4>
        <p class="contact">
          For tournament details - Contact:
          <a class="contact-mail hover-transition" [href]="'mailto:' + tournamentData.creator.email">
            {{ tournamentData.creator.email }}
          </a>
        </p>
      </div>
      @if (tournamentData.creator.id === currentUserProfile?.id || currentUserProfile?.roleName === 'ADMIN') {
        <div class="action-wrapper">
          @if (roundsData.length === 0 && tournamentData.teams.length < 8) {
            <app-e-input
              label="Add Participant"
              [isSearch]="true"
              [searchResult]="searchTeamNames"
              (inputChanged)="getTeamByName($event)"
              (searchResultSelected)="selectTeam($event)"
            />
          } @else {
            <app-e-button (click)="onStartClick()">Start</app-e-button>
          }

          @if (showEndButton()) {
            <app-e-button (click)="onEndClick()">End</app-e-button>
          }

          <div class="error-message" [ngStyle]="{ 'align-self': 'center' }">
            {{ startTournamentError }}
          </div>
          <img
            class="action-icon hover-transition"
            src="assets/images/edit-icon.svg"
            alt="Edit icon"
            (click)="onEditClick()"
          />
          <img
            class="action-icon hover-transition"
            src="assets/images/delete-icon.svg"
            alt="Edit icon"
            (click)="onDeleteClick()"
          />
        </div>
      }
    </div>

    @if (
      roundsData.length === 0 &&
      currentUserProfile !== null &&
      (tournamentData.creator.id === currentUserProfile.id || currentUserProfile.roleName === 'ADMIN')
    ) {
      <div id="tournament-actions">
        <app-e-input
          label="Add team"
          [isSearch]="true"
          [searchResult]="searchTeamNames"
          (inputChanged)="getTeamByName($event)"
          (searchResultSelected)="selectTeam($event)"
        />
      </div>
    }

    <div class="section-container">
      <div class="header-wrapper">
        <div class="title">Participent Teams</div>
        <hr />
      </div>

      <div class="info-cards-container">
        @for (currentTeam of tournamentTeamsData; track $index) {
          <app-e-info-card
            [cardData]="getTeamInfoCard(currentTeam)"
            (cardClicked)="onCardSelect(currentTeam.id, '/team')"
          >
            @if (
              !tournamentData.active &&
              !tournamentData.finished &&
              (tournamentData.creator.id === currentUserProfile?.id || currentUserProfile?.roleName === 'ADMIN')
            ) {
              <div actions class="actions" (click)="$event.stopPropagation(); onRemoveTeamClick(currentTeam.id)">
                <img src="assets/images/close-icon.svg" alt="Close icon" />
              </div>
            }

            <div statsIcons class="stats-info">
              <img src="assets/images/first-place-medal.svg" alt="First Place Medal" />
              <div class="subtitle">
                {{ currentTeam.tournamentsWon }}
              </div>

              <img src="assets/images/people-icon.svg" alt="People Icon" />
              <div class="subtitle">
                {{ currentTeam.members.length }}
              </div>
            </div>
          </app-e-info-card>
        }
      </div>
    </div>

    <div id="results-section" class="section-container">
      <div class="header-wrapper">
        <div class="title">Bracket</div>
        <hr />
      </div>
      @if (roundsData.length > 0) {
        <div class="bracket-wrapper">
          @if (ranking.length !== 0) {
            <div id="tournament-ranking-wrapper">
              @for (currentPlace of ranking; track $index) {
                <div
                  class="ranking-row hover-transition"
                  [ngClass]="{
                    first: $index === 7,
                    second: $index === 6,
                    third: [5, 4].includes($index),
                    fifth: [0, 1, 2, 3].includes($index),
                  }"
                >
                  <div class="name">
                    {{ currentPlace.name }}
                  </div>
                  <div class="place">
                    {{ currentPlace.place }}
                  </div>
                </div>
              }
            </div>
          }

          <app-tournament-bracket
            [roundsData]="roundsData"
            [tournamentId]="tournamentId"
            [canChooseWinner]="
              currentUserProfile !== null &&
              (tournamentData.creator.id === currentUserProfile.id || currentUserProfile.roleName === 'ADMIN')
            "
          />
        </div>
      }
    </div>
  }
</div>
